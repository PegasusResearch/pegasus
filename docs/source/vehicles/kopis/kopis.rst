Kopis Drone
===========

In this section, we describe the setup of the Kopis Cinewhoop 3" drone. Equipped with either a KakuteH7 or a KakuteH7v2 flight controller and an ESP8266 module for communication with an offboard computer, the Kopis Cinewhoop 3" is a small drone that enables the fast prototyping and testing of control algoritms in dedicated flight arenas such as the :ref:`Taguspark Flight Arena`.

.. image:: https://holybro.com/cdn/shop/products/30064_2_1800x1800.jpg?v=1647227793
  :width: 600
  :align: center
  :alt: Kopis 3 drone (source: Holybro)

Arena Setup
-----------

.. list-table:: ID, IPs and Mavlink Ports and other information
   :widths: 5 15 5 15 10 10 5 10 10
   :header-rows: 1
    
   * - ID
     - IP
     - Port
     - AP SSID
     - AP Password
     - Station SSID
     - Status
     - Kakute version
     - Config File
   * - 7
     - 192.168.1.247
     - 15007
     - CineWhoop3-7
     - pixracer
     - Quadrotor
     - ✔️
     - KakuteH7v2
     - `kopis7.params <https://github.com/PegasusResearch/drone_configs/blob/main/Kopis/Parameters/kopis_7.params>`__
   * - 8
     - 192.168.1.248
     - 15008
     - CineWhoop3-8
     - pixracer
     - Quadrotor
     - ✔️
     - KakuteH7v2
     - `kopis8.params <https://github.com/PegasusResearch/drone_configs/blob/main/Kopis/Parameters/kopis_8.params>`__
   * - 9
     - 192.168.1.249
     - 15009
     - CineWhoop3-9
     - pixracer
     - Quadrotor
     - ✔️
     - KakuteH7v2
     - `kopis9.params <https://github.com/PegasusResearch/drone_configs/blob/main/Kopis/Parameters/kopis_9.params>`__
   * - 10
     - 192.168.1.250
     - 15010
     - CineWhoop3-10
     - pixracer
     - Quadrotor
     - ✔️
     - KakuteH7v2
     - `kopis10.params <https://github.com/PegasusResearch/drone_configs/blob/main/Kopis/Parameters/kopis_10.params>`__
   * - 11
     - 192.168.1.251
     - 15011
     - CineWhoop3-11
     - pixracer
     - Quadrotor
     - ✔️
     - KakuteH7
     - TBD
   * - 12
     - 192.168.1.252
     - 15012
     - CineWhoop3-12
     - pixracer
     - Quadrotor
     - ❌
     - KakuteH7
     - TBD

The vehicles are configured to connect to the station network if the Statis SSID is detected. Otherwise, the vehicles will create an AP with the AP SSID and AP Password, according to the table above.

Running the Kopis 3"
--------------------

1. Install the Pegasus GNC code by following the instructions on the :ref:`Installation` page.

2. Turn on the Kopis 3" drone by connecting the battery.

3. Make sure your computer is connected to the station network or the AP network generated by the vehicle.

4. Ensure that you can see the vehicle in the Flight Arena desktop computer using the Mocap system.

  .. admonition:: Flight arena desktop computer

    The name of the vehicle must follow the standard naming convention, e.g., ``drone7``, in order for the GNC code to properly receive and use the pose information. Check the :ref:`Taguspark Flight Arena` page for more information.


  Run the following command to start the GNC code:

  .. code:: bash

    ros2 launch pegasus kopis.launch.py vehicle_id:=<vehicle_id>

  .. admonition:: Default vehicle ID and namespace

    If no vehicle_id is provided, the default ``vehicle_id`` is 7. The default namespace is ``vehicle_namespace:=drone``.

5. The vehicle should now be connected to the offboard computer and ready to receive commands.

6. Open the terminal console to control the vehicle

  .. code:: bash

    ros2 run pegasus_console pegasus_console -i <vehicle_id>

  .. admonition:: Launching all kopis drones at the same time

    You can also launch all the Kopis drones at the same time by running the following command:

    .. code:: bash

      ros2 launch pegasus all_kopis.launch.py

    Note that you will still need to open a console for each vehicle to control them individually, or you can write a script to perform automated tasks.

**All the provided vehicles are configured such that they will not arm unless an RC remote is connected. This is a safety feature to prevent the vehicle from taking off unintentionally. All the vehicles are binded to the same RC remote, so you can use the same remote to control all the vehicles.**

.. toctree::
   :glob:
   :maxdepth: 2

   assembly