<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Software Setup &mdash; Pegasus  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Kopis Drone" href="../kopis/kopis.html" />
    <link rel="prev" title="Drone Assembly" href="assembly.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #000000" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup/project_setup.html">Project Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup/reference_frames.html">Standards</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../features/autopilot/main.html">Autopilot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../console/terminal_console.html">Terminal console</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Simulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../simulation/gazebo_classic.html">Gazebo Classic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulation/pegasus_simulator.html">Pegasus Simulator</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vehicles</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../vehicles.html">Vehicles</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="pegasus.html">Pegasus Drone</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="assembly.html">Drone Assembly</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Software Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flashing-the-jetson-orin-nano">Flashing the Jetson Orin Nano</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecting-the-jetson-to-wifi">Connecting the Jetson to Wifi</a></li>
<li class="toctree-l4"><a class="reference internal" href="#passwordless-ssh">Passwordless SSH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#removing-pre-installed-software">Removing Pre-installed Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-nvidia-video-codec-sdk">Installing NVIDIA Video Codec SDK</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-opencv-with-gpu-acceleration">Installing OpenCV with GPU Acceleration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-ros-2">Installing ROS 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-gpio-pins">Setting up the GPIO pins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#disabling-gui">Disabling GUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#realsense-setup">Realsense Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-a-github-ssh-key">Setup a Github SSH Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-pegasus-gnc">Installing Pegasus GNC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-machine-learning-libraries">Installing Machine Learning Libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-nvslam-for-nvidia-jetson-orin-nano">Installing NVSlam (for NVIDIA Jetson Orin Nano)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-setup">Network Setup</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../kopis/kopis.html">Kopis Drone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../system_identification.html">System Identification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Flight Arena</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arena/arena.html">Taguspark Flight Arena</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../references/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #000000" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pegasus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../vehicles.html">Vehicles</a></li>
          <li class="breadcrumb-item"><a href="pegasus.html">Pegasus Drone</a></li>
      <li class="breadcrumb-item active">Software Setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/source/vehicles/pegasus/software.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="software-setup">
<h1>Software Setup<a class="headerlink" href="#software-setup" title="Permalink to this heading"></a></h1>
<p>In order to get your Pegasus drone ready to fly, you need to setup the software stack. This includes installing the necessary software packages, setting up the network, and configuring the GPIO pins. It also includes flashing the Kakute H7 microcontroller with PX4.</p>
<section id="flashing-the-jetson-orin-nano">
<h2>Flashing the Jetson Orin Nano<a class="headerlink" href="#flashing-the-jetson-orin-nano" title="Permalink to this heading"></a></h2>
<p>In order to setup the Jetson Orin Nano Developer Kit, follow the instructions bellow.</p>
<ol class="arabic simple">
<li><p>Start by installing the <a class="reference external" href="https://developer.nvidia.com/sdk-manager">Nvidia SDK manager</a> on a machine with Ubuntu 22.04LTS or later.</p></li>
<li><p>Connect the Jetson Orin Nano Developer Kit to the machine using a USB-C cable.</p></li>
<li><p>Short the FC REC and GND pins on the Jetson Orin Nano Developer Kit, under the SoC module.</p></li>
<li><p>Connect the Jetson Orin Nano Developer Kit to the power supply.</p></li>
<li><p>Before opening the Nvidia SDK Manager, make sure to turn off the Ubuntu Firewall (if enabled) by running the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ufw<span class="w"> </span>disable
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Open the Nvidia SDK Manager and select the Jetson Orin Nano Developer Kit from the list of devices.</p></li>
</ol>
<a class="reference internal image-reference" href="../../../_images/sdk_manager_device.png"><img alt="Nvidia SDK Manager Device selection" class="align-center" src="../../../_images/sdk_manager_device.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="7">
<li><p>Select all the modules that can be installed and the latest jetpack version. Setup the <code class="docutils literal notranslate"><span class="pre">Pre-config</span></code> option and set the username (for example <code class="docutils literal notranslate"><span class="pre">pegasus</span></code>) and password, and continue.</p></li>
</ol>
<a class="reference internal image-reference" href="../../../_images/sdk_manager_installing.png"><img alt="Nvidia SDK Manager Modules selection" class="align-center" src="../../../_images/sdk_manager_installing.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="8">
<li><p>After the OS is installed, the Jetson Orin Nano Developer Kit will reboot and you will be prompted to enter the defined username and password for the installation to continue.</p></li>
</ol>
<a class="reference internal image-reference" href="../../../_images/sdk_manager_jetpack.png"><img alt="Nvidia SDK Manager Jetpack installation" class="align-center" src="../../../_images/sdk_manager_jetpack.png" style="width: 600px;" /></a>
<p>9. After this step is finished, you can unplug the Jetson Orin Nano Developer Kit from the power. Remove the short between the FC REC and GND pins and connect the Jetson Orin Nano Developer Kit to the power supply again.
Don’t forget, it you disabled the Ubuntu Firewall, you should enable it again by running the following command:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>
</pre></div>
</div>
</div></blockquote>
<p>You can find more information on the <a class="reference external" href="https://developer.nvidia.com/embedded/learn/get-started-jetson-orin-nano-devkit">Nvidia Jetson Orin Nano Developer Kit</a> page.</p>
</section>
<section id="connecting-the-jetson-to-wifi">
<h2>Connecting the Jetson to Wifi<a class="headerlink" href="#connecting-the-jetson-to-wifi" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>After the Jetson reboots, an SSH connection is available through the USB-C connection. SSH into the Jetson Orin Nano using the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>&lt;username&gt;@192.168.55.1
</pre></div>
</div>
</div></blockquote>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">&lt;username&gt;</span></code> with the username you defined during the installation process.</p>
<ol class="arabic simple" start="2">
<li><p>Connect the Jetson to a wifi network by running the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nmcli<span class="w"> </span>device<span class="w"> </span>wifi<span class="w"> </span>connect<span class="w"> </span>&lt;SSID&gt;<span class="w"> </span>password<span class="w"> </span>&lt;password&gt;
</pre></div>
</div>
<div class="admonition-wifi-connection admonition">
<p class="admonition-title">Wifi Connection</p>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">&lt;SSID&gt;</span></code> with the wifi network name and the <code class="docutils literal notranslate"><span class="pre">&lt;password&gt;</span></code> with the wifi network password. If you need to check the wifi networks available, you can run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nmcli<span class="w"> </span>device<span class="w"> </span>wifi<span class="w"> </span>list
</pre></div>
</div>
<p>To check the connection status, you can run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nmcli<span class="w"> </span>device<span class="w"> </span>status
</pre></div>
</div>
</div>
</div></blockquote>
</section>
<section id="passwordless-ssh">
<h2>Passwordless SSH<a class="headerlink" href="#passwordless-ssh" title="Permalink to this heading"></a></h2>
<p>To enable passwordless SSH, follow the instructions bellow.</p>
<ol class="arabic simple">
<li><p>Generate an SSH key on your computer and copy it to the remote machine:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the SSH key</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;your_email@example.com&quot;</span><span class="w"> </span>-f<span class="w"> </span>~/.ssh/pegasus

<span class="c1"># Copy the SSH key to the remote machine</span>
ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/pegasus.pub<span class="w"> </span>&lt;drone_username&gt;@&lt;drone_ip&gt;

<span class="c1"># Test the connection</span>
ssh<span class="w"> </span>&lt;drone_user&gt;@&lt;drone_ip&gt;
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Add the following to your computer ~/.ssh/config file:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Host<span class="w"> </span>&lt;Hostname<span class="w"> </span><span class="o">(</span>example:<span class="w"> </span>pegasus<span class="o">)</span>&gt;
<span class="w">  </span>HostName<span class="w"> </span>drone_ip
<span class="w">  </span>User<span class="w"> </span>&lt;drone_user&gt;
<span class="w">  </span>IdentityFile<span class="w"> </span>~/.ssh/pegasus
<span class="w">  </span>AddKeysToAgent<span class="w"> </span>yes
<span class="w">  </span>IdentitiesOnly<span class="w"> </span>yes
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Now you should be able to SSH into the Jetson without the need for a password:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>&lt;Hostname&gt;
</pre></div>
</div>
</div></blockquote>
</section>
<section id="removing-pre-installed-software">
<h2>Removing Pre-installed Software<a class="headerlink" href="#removing-pre-installed-software" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Install basic software packages by running the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>htop<span class="w"> </span>tmux<span class="w"> </span>nano<span class="w"> </span>python3-pip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>autoremove
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.24.0
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nvidia-jetpack
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Remove “garbage” that comes pre-installed by default:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>purge<span class="w"> </span>thunderbird<span class="w"> </span>libreoffice-*<span class="w"> </span>onboard<span class="w"> </span>aisleriot<span class="w"> </span>gnome-sudoku<span class="w"> </span>gnome-mines<span class="w"> </span>gnome-mahjongg<span class="w"> </span>cheese<span class="w"> </span>gnome-calculator<span class="w"> </span>gnome-todo<span class="w"> </span>shotwell<span class="w"> </span>gnome-calendar<span class="w"> </span>rhythmbox<span class="w"> </span>simple-scan<span class="w"> </span>remmina<span class="w"> </span>transmission-gtk<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>autoremove<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>clean
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Install Jetson Stats by running the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>-H<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>jetson-stats<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>jtop.service
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Reboot the Jetson and SSH into the Jetson again. Run the following command:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>reboot
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Run Jetson Stats and set the power mode to MAXN (for maximum performance):</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jtop
</pre></div>
</div>
</div></blockquote>
</section>
<section id="installing-nvidia-video-codec-sdk">
<h2>Installing NVIDIA Video Codec SDK<a class="headerlink" href="#installing-nvidia-video-codec-sdk" title="Permalink to this heading"></a></h2>
<p>To enable video processing with GPU acceleration, you need to install the NVIDIA Video Codec SDK. Follow the instructions bellow:</p>
<ol class="arabic simple">
<li><p>Download the latest NVIDIA Video Codec from <code class="docutils literal notranslate"><span class="pre">https://developer.nvidia.com/nvidia-video-codec-sdk/download</span></code>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the video codec sdk</span>
<span class="nb">cd</span><span class="w"> </span>~
wget<span class="w"> </span>https://developer.nvidia.com/downloads/designworks/video-codec-sdk/secure/13.0.19/video_codec_sdk_13.0.19.zip
unzip<span class="w"> </span>video_codec_sdk_13.0.19.zip
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Copy the library into the cuda library directory</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy the library to the cuda directory</span>
sudo<span class="w"> </span>cp<span class="w"> </span>~/Video_Codec_SDK_13.0.19/Lib/linux/stubs/aarch64/libnvcuvid.so<span class="w"> </span>/usr/local/cuda/lib64/libnvcuvid.so
sudo<span class="w"> </span>cp<span class="w"> </span>~/Video_Codec_SDK_13.0.19/Lib/linux/stubs/aarch64/libnvidia-encode.so<span class="w"> </span>/usr/local/cuda/lib64/libnvidia-encode.so

<span class="c1"># Copy the header files to the cuda directory</span>
sudo<span class="w"> </span>cp<span class="w"> </span>-s<span class="w"> </span>~/Video_Codec_SDK_13.0.19/Interface/cuviddec.h<span class="w"> </span>/usr/local/cuda/include/cuviddec.h
sudo<span class="w"> </span>cp<span class="w"> </span>-s<span class="w"> </span>~/Video_Codec_SDK_13.0.19/Interface/nvcuvid.h<span class="w"> </span>/usr/local/cuda/include/nvcuvid.h
sudo<span class="w"> </span>cp<span class="w"> </span>-s<span class="w"> </span>~/Video_Codec_SDK_13.0.19/Interface/nvEncodeAPI.h<span class="w"> </span>/usr/local/cuda/include/nvEncodeAPI.h

<span class="c1"># Update the linking libraries</span>
sudo<span class="w"> </span>ldconfig
</pre></div>
</div>
</div></blockquote>
</section>
<section id="installing-opencv-with-gpu-acceleration">
<h2>Installing OpenCV with GPU Acceleration<a class="headerlink" href="#installing-opencv-with-gpu-acceleration" title="Permalink to this heading"></a></h2>
<p>For some reason, the OpenCV that comes pre-installed in the Jetson is not compiled with CUDA support enabled, nor video processing with GPU acceleration. To enable CUDA support, follow the instructions bellow.</p>
<ol class="arabic simple">
<li><p>Install OpenCV with CUDA support</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the old opencv installation</span>
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/usr/include/opencv4/opencv2
sudo<span class="w"> </span>apt<span class="w"> </span>purge<span class="w"> </span>-y<span class="w"> </span>*libopencv*

<span class="c1"># Go into the home directory</span>
<span class="nb">cd</span><span class="w"> </span>~

<span class="c1"># Download the latest version</span>
git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>https://github.com/opencv/opencv.git<span class="w"> </span>-b<span class="w"> </span><span class="m">4</span>.11.0
git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>https://github.com/opencv/opencv_contrib.git<span class="w"> </span>-b<span class="w"> </span><span class="m">4</span>.11.0

<span class="c1"># reveal the CUDA location</span>
<span class="nb">cd</span><span class="w"> </span>~
sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;/usr/local/cuda/lib64&#39; &gt;&gt; /etc/ld.so.conf.d/nvidia-tegra.conf&quot;</span>
sudo<span class="w"> </span>ldconfig

<span class="c1"># Create the build directory</span>
<span class="nb">cd</span><span class="w"> </span>~/opencv
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build

<span class="c1"># Setup the architecture for cuda in the jetson orin nano</span>
<span class="c1"># Check the version for your board in: https://developer.nvidia.com/cuda-gpus#compute</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span><span class="m">8</span>.7
<span class="nb">export</span><span class="w"> </span><span class="nv">PTX</span><span class="o">=</span><span class="s2">&quot;sm_87&quot;</span>

<span class="c1"># Install mathematic libraries</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>libopenblas-dev<span class="w"> </span>libopenblas-base<span class="w"> </span>libatlas-base-dev<span class="w"> </span>liblapacke-dev

<span class="c1"># Install some dependencies</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>libswresample-dev<span class="w"> </span>libdc1394-dev<span class="w"> </span>cmake<span class="w"> </span>libjpeg-dev<span class="w"> </span>libjpeg8-dev<span class="w"> </span>libjpeg-turbo8-dev<span class="w"> </span>libpng-dev<span class="w"> </span>libtiff-dev<span class="w"> </span>libglew-dev<span class="w"> </span>libavcodec-dev<span class="w"> </span>libavformat-dev<span class="w"> </span>libswscale-dev<span class="w"> </span>libgtk2.0-dev<span class="w"> </span>libgtk-3-dev<span class="w"> </span>libcanberra-gtk*<span class="w"> </span>libxvidcore-dev<span class="w"> </span>libx264-dev<span class="w"> </span>libtbb-dev<span class="w"> </span>libxine2-dev<span class="w"> </span>libv4l-dev<span class="w"> </span>v4l-utils<span class="w"> </span>qv4l2<span class="w"> </span>libtesseract-dev<span class="w"> </span>libpostproc-dev<span class="w"> </span>libvorbis-dev<span class="w"> </span>libfaac-dev<span class="w"> </span>libmp3lame-dev<span class="w"> </span>libtheora-dev<span class="w"> </span>libopencore-amrnb-dev<span class="w"> </span>libopencore-amrwb-dev<span class="w"> </span>libopenblas-dev<span class="w"> </span>libatlas-base-dev<span class="w"> </span>libblas-dev<span class="w"> </span>liblapack-dev<span class="w"> </span>liblapacke-dev<span class="w"> </span>libeigen3-dev<span class="w"> </span>gfortran<span class="w"> </span>libhdf5-dev<span class="w"> </span>libprotobuf-dev<span class="w"> </span>protobuf-compiler<span class="w"> </span>libgoogle-glog-dev<span class="w"> </span>libgflags-dev

<span class="c1"># run cmake (with as much CUDA acceleration as we can)</span>
cmake<span class="w"> </span>-D<span class="w"> </span><span class="nv">CMAKE_BUILD_TYPE</span><span class="o">=</span>RELEASE<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="o">=</span>/usr<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">OPENCV_EXTRA_MODULES_PATH</span><span class="o">=</span>~/opencv_contrib/modules<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">EIGEN_INCLUDE_PATH</span><span class="o">=</span>/usr/include/eigen3<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_OPENCL</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">CUDA_ARCH_BIN</span><span class="o">=</span><span class="si">${</span><span class="nv">ARCH</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">CUDA_ARCH_PTX</span><span class="o">=</span><span class="si">${</span><span class="nv">PTX</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_CUDA</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_CUDNN</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_NVCUVID</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_CUBLAS</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">ENABLE_FAST_MATH</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">CUDA_FAST_MATH</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">OPENCV_DNN_CUDA</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">ENABLE_NEON</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_QT</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_OPENMP</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">BUILD_TIFF</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_FFMPEG</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_GSTREAMER</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_TBB</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">BUILD_TBB</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">BUILD_TESTS</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_EIGEN</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_V4L</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_LIBV4L</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">WITH_PROTOBUF</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">OPENCV_ENABLE_NONFREE</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">INSTALL_C_EXAMPLES</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">INSTALL_PYTHON_EXAMPLES</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">PYTHON3_PACKAGES_PATH</span><span class="o">=</span>/usr/lib/python3/dist-packages<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">OPENCV_GENERATE_PKGCONFIG</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">BUILD_EXAMPLES</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">JPEG_INCLUDE_DIR</span><span class="o">=</span>/usr/include<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">JPEG_LIBRARY</span><span class="o">=</span>/usr/lib/aarch64-linux-gnu/libjpeg.a<span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">CMAKE_CXX_FLAGS</span><span class="o">=</span><span class="s2">&quot;-march=native -mtune=native&quot;</span><span class="w"> </span><span class="se">\</span>
-D<span class="w"> </span><span class="nv">CMAKE_C_FLAGS</span><span class="o">=</span><span class="s2">&quot;-march=native -mtune=native&quot;</span><span class="w"> </span>..

<span class="c1"># Compile the code</span>
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</pre></div>
</div>
<div class="admonition-warning admonition">
<p class="admonition-title">Warning</p>
<p>This is the time where you should go grab a cup of coffe and wait for the compilation to finish. If the compilation fails due to NVIDIA Video Codec SDK, this is because OpenCV has a bug yet to be fixed regarding the latest version of the NVIDIA SDK. Just go to the file where the compilation is failing and replace the lines that are causing the error with the option provided bellow - If the offending file is <code class="docutils literal notranslate"><span class="pre">opencv_contrib/modules/cudacodec/src/NvEncoder.cpp</span></code>, replace the lines 126 and 185 with the pre-compiler if code directly above.</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Install the compiled library in the system</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the compiled library in the system</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig

<span class="c1"># Clean the compiled code fromt the build directory</span>
make<span class="w"> </span>clean
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Test the installation</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open python3 in the terminal</span>
python3

<span class="c1"># Run the following code</span>
import<span class="w"> </span>cv2
<span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.cuda.getCudaEnabledDeviceCount<span class="o">()</span>
print<span class="o">(</span>count<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="installing-ros-2">
<h2>Installing ROS 2<a class="headerlink" href="#installing-ros-2" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Install ROS 2 Humble, by following the instructions on the <a class="reference external" href="https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debs.html">ROS 2 Humble</a> page.</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Locale setup</span>
locale<span class="w">  </span><span class="c1"># check for UTF-8</span>

sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>locales
sudo<span class="w"> </span>locale-gen<span class="w"> </span>en_US<span class="w"> </span>en_US.UTF-8
sudo<span class="w"> </span>update-locale<span class="w"> </span><span class="nv">LC_ALL</span><span class="o">=</span>en_US.UTF-8<span class="w"> </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
<span class="nb">export</span><span class="w"> </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8

locale<span class="w">  </span><span class="c1"># verify settings</span>

<span class="c1"># Setup sources.list</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>software-properties-common
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>universe

sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>curl<span class="w"> </span>-y
sudo<span class="w"> </span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://raw.githubusercontent.com/ros/rosdistro/master/ros.key<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/ros-archive-keyring.gpg

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu </span><span class="k">$(</span>.<span class="w"> </span>/etc/os-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$UBUNTU_CODENAME</span><span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/ros2.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>upgrade

<span class="c1"># Install ROS 2 packages</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ros-humble-desktop<span class="w"> </span>-y
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ros-dev-tools<span class="w"> </span>-y

<span class="c1"># Add the ROS 2 environment to the bashrc</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source /opt/ros/humble/setup.bash&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</div></blockquote>
</section>
<section id="setting-up-the-gpio-pins">
<h2>Setting up the GPIO pins<a class="headerlink" href="#setting-up-the-gpio-pins" title="Permalink to this heading"></a></h2>
<p>To setup the serial pins for communication with the microcontroller, follow the instructions bellow:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>nvgetty.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>nvgetty.service
sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>dialout<span class="w"> </span>&lt;username&gt;
</pre></div>
</div>
</div></blockquote>
</section>
<section id="disabling-gui">
<h2>Disabling GUI<a class="headerlink" href="#disabling-gui" title="Permalink to this heading"></a></h2>
<p>For a better performance, it is recommended to disable the GNOME GUI. To do so, follow the instructions bellow:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the system to boot in text mode</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>set-default<span class="w"> </span>multi-user.target
</pre></div>
</div>
</div></blockquote>
<div class="admonition-optional admonition">
<p class="admonition-title">Optional</p>
<p>Alternatively, you can remove the GUI packages altogether by running the following lines.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the GNOME GUI</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>purge<span class="w"> </span>gnome-shell<span class="w"> </span>ubuntu-wallpapers-bionic<span class="w"> </span>light-themes<span class="w"> </span>chromium-browser*<span class="w"> </span>libvisionworks<span class="w"> </span>libvisionworks-sfm-dev<span class="w"> </span>-y
sudo<span class="w"> </span>apt-get<span class="w"> </span>autoremove<span class="w"> </span>-y
sudo<span class="w"> </span>apt<span class="w"> </span>clean<span class="w"> </span>-y

<span class="c1"># Setup the system to boot in text mode</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>set-default<span class="w"> </span>multi-user.target
</pre></div>
</div>
<p>In practice, we just disable the GUI but keep the packages installed in case we need to use the GUI in the future.</p>
</div>
</section>
<section id="realsense-setup">
<h2>Realsense Setup<a class="headerlink" href="#realsense-setup" title="Permalink to this heading"></a></h2>
<p>The next step is to install the realsense library for the Intel RealSense cameras. Follow the instructions bellow.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Go to the home directory</span>
<span class="nb">cd</span><span class="w"> </span>~

<span class="c1"># Install some dependencies</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>cmake<span class="w"> </span>libssl-dev<span class="w"> </span>freeglut3-dev<span class="w"> </span>libusb-1.0-0-dev<span class="w"> </span>pkg-config<span class="w"> </span>libgtk-3-dev<span class="w"> </span>unzip<span class="w"> </span>-y

<span class="c1"># Clone the correct version of the library that matches the ROS 2 version that we are using in Pegasus</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/IntelRealSense/librealsense.git<span class="w"> </span>-b<span class="w"> </span>v2.56.3

<span class="c1"># Create the build directory where the code will be compiled</span>
<span class="nb">cd</span><span class="w"> </span>librealsense
mkdir<span class="w"> </span>librealsense_build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>librealsense_build

<span class="c1"># Setup the udev rules for the driver to be able to access the camera data</span>
sudo<span class="w"> </span>cp<span class="w"> </span>../config/99-realsense-libusb.rules<span class="w"> </span>/etc/udev/rules.d/
sudo<span class="w"> </span>udevadm<span class="w"> </span>control<span class="w"> </span>--reload-rules<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>udevadm<span class="w"> </span>trigger

<span class="c1"># Setup the architecture for cuda in the orin nano</span>
<span class="c1"># Check: https://developer.nvidia.com/cuda-gpus#compute</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span><span class="m">8</span>.7

<span class="c1"># Compile the code with CUDA support and python bindings</span>
cmake<span class="w"> </span>../<span class="w"> </span>-DBUILD_EXAMPLES<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DFORCE_RSUSB_BACKEND<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DBUILD_WITH_CUDA<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>release<span class="w"> </span>-DBUILD_PYTHON_BINDINGS<span class="o">=</span>bool:true<span class="w"> </span>-DPYTHON_EXECUTABLE<span class="o">=</span>/usr/bin/python3
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>

<span class="c1"># Install the library in the system</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig

<span class="c1"># Reboot the PC - The next time you boot, the intel realsense camera should be working</span>
sudo<span class="w"> </span>reboot

<span class="c1"># Test the camera (should still be laggy, but it is ok for now, dont worry)</span>
realsense-viewer
</pre></div>
</div>
</div></blockquote>
</section>
<section id="setup-a-github-ssh-key">
<h2>Setup a Github SSH Key<a class="headerlink" href="#setup-a-github-ssh-key" title="Permalink to this heading"></a></h2>
<p>To <a class="reference external" href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">setup an SSH key for your Github account</a>, follow the instructions bellow.</p>
<ol class="arabic simple">
<li><p>Generate an SSH key on the Jetson computer:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the SSH key</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;your_email@example.com&quot;</span><span class="w"> </span>-f<span class="w"> </span>~/.ssh/github

<span class="c1"># Start the ssh agent in the background</span>
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>ssh-agent<span class="w"> </span>-s<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Add your key to the agent</span>
ssh-add<span class="w"> </span>~/.ssh/github
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Add the following to the jetson ~/.ssh/config file:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Host<span class="w"> </span>github.com
<span class="w">  </span>HostName<span class="w"> </span>github.com
<span class="w">  </span>User<span class="w"> </span>git
<span class="w">  </span>IdentityFile<span class="w"> </span>~/.ssh/github
<span class="w">  </span>AddKeysToAgent<span class="w"> </span>yes
<span class="w">  </span>IdentitiesOnly<span class="w"> </span>yes
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Copy the public SSH key to your github account. To do so, go to your Github account settings and add the public key to the SSH keys section.</p></li>
</ol>
</section>
<section id="installing-pegasus-gnc">
<h2>Installing Pegasus GNC<a class="headerlink" href="#installing-pegasus-gnc" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Start by installing some dependencies</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the dependencies for CasADi (IPOPT)</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>coinor-libipopt-dev<span class="w"> </span>python3-pip

<span class="c1"># Install dependencies for the Realsense ROS 2 package</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>ros-humble-image-transport<span class="w"> </span>ros-humble-diagnostic-updater

<span class="c1"># Install dependencies for the video server</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>ros-humble-async-web-server-cpp
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Clone the Pegasus repository that contains the GNC code and configurations for the Pegasus vehicle built in.</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Go to the home directory</span>
<span class="nb">cd</span><span class="w"> </span>~

<span class="c1"># Clone the Pegasus repository that contains the GNC code + configurations for the drone itself</span>
git<span class="w"> </span>clone<span class="w"> </span>git@github.com:PegasusResearch/pegasus_drone.git<span class="w"> </span>--recursive
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Compile the Pegasus external code</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compile the Pegasus external code</span>
<span class="nb">cd</span><span class="w"> </span>pegasus_drone/pegasus_external
colcon<span class="w"> </span>build<span class="w"> </span>--symlink-install

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Run the following command to add the ROS 2 environment to the bashrc</span>
<span class="c1"># --------------------------------------------------------------------</span>

<span class="c1"># Add the ROS 2 environment to the bashrc if not already</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source </span><span class="nv">$HOME</span><span class="s2">/pegasus_drone/pegasus_external/install/setup.bash&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc

<span class="c1"># Add an alias to the bashrc for automatically source new terminals</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;alias s=&#39;source </span><span class="nv">$HOME</span><span class="s2">/.bashrc&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc

<span class="c1"># source your updated bashrc</span>
<span class="nb">source</span><span class="w"> </span>~/.bashrc
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Compile the Pegasus GNC code</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Go to the Pegasus GNC code</span>
<span class="nb">cd</span><span class="w"> </span>~/pegasus_drone/pegasus

<span class="c1"># Compile the Pegasus GNC code</span>
colcon<span class="w"> </span>build<span class="w"> </span>--symlink-install

<span class="c1"># Add the ROS 2 environment to the bashrc if not already</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source </span><span class="nv">$HOME</span><span class="s2">/pegasus_drone/pegasus/install/setup.bash&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Run the config.bash script that will install services to automatically start the jetson in the maximum power mode and start the Pegasus GNC code at boot.</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the config.bash script</span>
<span class="nb">cd</span><span class="w"> </span>~/pegasus_drone/pegasus/src/pegasus_drone/scripts
sudo<span class="w"> </span>./config.bash
</pre></div>
</div>
</div></blockquote>
</section>
<section id="installing-machine-learning-libraries">
<h2>Installing Machine Learning Libraries<a class="headerlink" href="#installing-machine-learning-libraries" title="Permalink to this heading"></a></h2>
<p><strong>1. Installing Pytorch</strong></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://docs.nvidia.com/deeplearning/frameworks/install-pytorch-jetson-platform/index.html</span>

<span class="c1"># Install CUSparse for accelerating computations</span>
wget<span class="w"> </span>https://developer.download.nvidia.com/compute/cusparselt/redist/libcusparse_lt/linux-aarch64/libcusparse_lt-linux-aarch64-0.6.3.2-archive.tar.xz
tar<span class="w"> </span>xf<span class="w"> </span>libcusparse_lt-linux-aarch64-0.6.3.2-archive.tar.xz
sudo<span class="w"> </span>cp<span class="w"> </span>-a<span class="w"> </span>libcusparse_lt-linux-aarch64-0.6.3.2-archive/include/*<span class="w"> </span>/usr/local/cuda/include/
sudo<span class="w"> </span>cp<span class="w"> </span>-a<span class="w"> </span>libcusparse_lt-linux-aarch64-0.6.3.2-archive/lib/*<span class="w"> </span>/usr/local/cuda/lib64/
sudo<span class="w"> </span>ldconfig

<span class="c1"># Check the versions + links for pytorch + tensorimage stuff</span>
https://forums.developer.nvidia.com/t/pytorch-for-jetson/72048
<span class="nb">export</span><span class="w"> </span><span class="nv">JP_VERSION</span><span class="o">=</span><span class="m">61</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYT_VERSION</span><span class="o">=</span>torch-2.5.0a0+872d972e41.nv24.08.17622132-cp310-cp310-linux_aarch64.whl
<span class="nb">export</span><span class="w"> </span><span class="nv">TORCH_INSTALL</span><span class="o">=</span>https://developer.download.nvidia.com/compute/redist/jp/v<span class="nv">$JP_VERSION</span>/pytorch/<span class="nv">$PYT_VERSION</span>
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>numpy
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache<span class="w"> </span><span class="nv">$TORCH_INSTALL</span>

<span class="c1"># Install the corresponding torch vision (see table in their repo)</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/pytorch/vision<span class="w"> </span>torchvision
<span class="nb">cd</span><span class="w"> </span>torchvision/
git<span class="w"> </span>checkout<span class="w"> </span>v0.20.1
<span class="nb">export</span><span class="w"> </span><span class="nv">USE_CUDA</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_CUDNN</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_MKLDNN</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">TORCH_CUDA_ARCH_LIST</span><span class="o">=</span><span class="s2">&quot;8.6&quot;</span><span class="w"> </span><span class="nv">FORCE_CUDA</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">FORCE_MPS</span><span class="o">=</span><span class="m">1</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>ffmpeg<span class="w"> </span>libavutil-dev<span class="w"> </span>libavcodec-dev<span class="w"> </span>libavformat-dev<span class="w"> </span>libavdevice-dev<span class="w"> </span>libavfilter-dev<span class="w"> </span>libswscale-dev<span class="w"> </span>libswresample-dev<span class="w"> </span>libswresample-dev<span class="w"> </span>libpostproc-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>libpng-dev<span class="w"> </span>libopenblas-base<span class="w"> </span>libopenmpi-dev
python3<span class="w"> </span>setup.py<span class="w"> </span>develop<span class="w"> </span>--user
</pre></div>
</div>
</div></blockquote>
<p><strong>2. Installing Tensorflow</strong></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>https://docs.nvidia.com/deeplearning/frameworks/install-tf-jetson-platform/index.html#overview
<span class="nb">export</span><span class="w"> </span><span class="nv">JP_VERSION</span><span class="o">=</span><span class="m">60</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TF_VERSION</span><span class="o">=</span>tensorflow-2.15.0+nv24.05-cp310-cp310-linux_aarch64.whl
<span class="nb">export</span><span class="w"> </span><span class="nv">TENSORFLOW_INSTALL</span><span class="o">=</span>https://developer.download.nvidia.com/compute/redist/jp/v<span class="nv">$JP_VERSION</span>/tensorflow/<span class="nv">$TF_VERSION</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libhdf5-serial-dev<span class="w"> </span>hdf5-tools<span class="w"> </span>libhdf5-dev<span class="w"> </span>zlib1g-dev<span class="w"> </span>zip<span class="w"> </span>libjpeg8-dev<span class="w"> </span>liblapack-dev<span class="w"> </span>libblas-dev<span class="w"> </span>gfortran
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>testresources<span class="w"> </span>setuptools<span class="w"> </span>numpy<span class="w"> </span>future<span class="w"> </span>mock<span class="w"> </span>keras_preprocessing<span class="w"> </span>keras_applications<span class="w"> </span>gast<span class="w"> </span>protobuf<span class="w"> </span>pybind11<span class="w"> </span>cython<span class="w"> </span>pkgconfig<span class="w"> </span>packaging<span class="w"> </span>h5py
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache<span class="w"> </span><span class="nv">$TENSORFLOW_INSTALL</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="installing-nvslam-for-nvidia-jetson-orin-nano">
<h2>Installing NVSlam (for NVIDIA Jetson Orin Nano)<a class="headerlink" href="#installing-nvslam-for-nvidia-jetson-orin-nano" title="Permalink to this heading"></a></h2>
<p>NVSlam is a library for visual SLAM (Simultaneous Localization and Mapping) that is optimized for NVIDIA Jetson devices. It provides a high-performance solution for visual SLAM applications.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Go to the home directory</span>
<span class="nb">cd</span><span class="w"> </span>~

<span class="c1"># Clone the Isaac ROS common repository and compile it</span>
git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>release-3.2<span class="w"> </span>https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_common.git<span class="w"> </span>isaac_ros_common
<span class="nb">cd</span><span class="w"> </span>isaac_ros_common
colcon<span class="w"> </span>build<span class="w"> </span>--symlink-install

<span class="c1"># Add the isaac-ros CDN</span>
wget<span class="w"> </span>-qO<span class="w"> </span>-<span class="w"> </span>https://isaac.download.nvidia.com/isaac-ros/repos.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
grep<span class="w"> </span>-qxF<span class="w"> </span><span class="s2">&quot;deb https://isaac.download.nvidia.com/isaac-ros/release-3 </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> release-3.0&quot;</span><span class="w"> </span>/etc/apt/sources.list<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb https://isaac.download.nvidia.com/isaac-ros/release-3 </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> release-3.0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/apt/sources.list
sudo<span class="w"> </span>apt-get<span class="w"> </span>update

sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>curl<span class="w"> </span>-y
sudo<span class="w"> </span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://raw.githubusercontent.com/ros/rosdistro/master/ros.key<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/ros-archive-keyring.gpg

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu </span><span class="k">$(</span>.<span class="w"> </span>/etc/os-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$UBUNTU_CODENAME</span><span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/ros2.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Install the NVSlam ROS2 package</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>ros-humble-isaac-ros-visual-slam
</pre></div>
</div>
</div></blockquote>
</section>
<section id="network-setup">
<h2>Network Setup<a class="headerlink" href="#network-setup" title="Permalink to this heading"></a></h2>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">ID, IPs and Mavlink Ports and other information</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 6%" />
<col style="width: 18%" />
<col style="width: 18%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Station SSID</p></th>
<th class="head"><p>Station IP</p></th>
<th class="head"><p>Forward Address</p></th>
<th class="head"><p>Status</p></th>
<th class="head"><p>Kakute version</p></th>
<th class="head"><p>Config File Indoor (Mocap)</p></th>
<th class="head"><p>Config File Outdoor (GPS)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Personal</p></td>
<td><p>Quadrotor</p></td>
<td><p>192.168.1.166</p></td>
<td><p>192.168.1.232:15000</p></td>
<td><p>✔️</p></td>
<td><p>KakuteH7v1.3-mini</p></td>
<td><p>pegasus.params</p></td>
<td><p>pegasus.params</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Quadrotor</p></td>
<td><p>192.168.1.241</p></td>
<td><p>192.168.1.232:15001</p></td>
<td><p>❌</p></td>
<td><p>KakuteH7v1.3</p></td>
<td><p>TODO</p></td>
<td><p>TODO</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Quadrotor</p></td>
<td><p>192.168.1.242</p></td>
<td><p>192.168.1.232:15002</p></td>
<td><p>❌</p></td>
<td><p>KakuteH7v1.3</p></td>
<td><p>TODO</p></td>
<td><p>TODO</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="assembly.html" class="btn btn-neutral float-left" title="Drone Assembly" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../kopis/kopis.html" class="btn btn-neutral float-right" title="Kopis Drone" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Marcelo Jacinto.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>